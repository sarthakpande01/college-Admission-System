<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub OAuth Callback</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .callback-container {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="callback-container">
        <div class="spinner"></div>
        <h2>Processing GitHub Login...</h2>
        <p>Please wait while we complete your authentication.</p>
    </div>

    <script>
        // Get the authorization code from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const state = urlParams.get('state'); // This contains the userType
        
        if (code) {
            // In a real application, you would exchange this code for an access token
            // on your backend server. For this demo, we'll simulate the process.
            
            // Simulate API call to exchange code for token
            setTimeout(() => {
                // Mock user data from GitHub
                const mockGitHubUser = {
                    email: 'user@example.com',
                    name: 'GitHub User',
                    avatar: 'https://ui-avatars.com/api/?name=GitHub+User&background=333&color=fff&size=40',
                    provider: 'github',
                    userType: state || 'student'
                };
                
                // Store user data in localStorage
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const existingUserIndex = users.findIndex(user => user.email === mockGitHubUser.email);
                
                if (existingUserIndex >= 0) {
                    users[existingUserIndex] = { ...users[existingUserIndex], ...mockGitHubUser };
                } else {
                    users.push(mockGitHubUser);
                }
                
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', mockGitHubUser.email);
                localStorage.setItem('userType', mockGitHubUser.userType);
                localStorage.setItem('authToken', 'github_token_' + Date.now());
                
                // Redirect back to main page
                window.location.href = 'index.html';
            }, 2000);
        } else {
            // Handle error
            setTimeout(() => {
                alert('GitHub authentication failed. Please try again.');
                window.location.href = 'index.html';
            }, 1000);
        }
    </script>
</body>
</html> 